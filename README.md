# Rick and Morty Character Explorer

Веб-приложение для поиска и просмотра информации о персонажах мультсериала "Рик и Морти" с интеграцией ИИ для генерации описаний персонажей.

## Краткое описание проекта

Это SPA-приложение позволяет пользователям:
- Искать персонажей по имени с мгновенными результатами
- Просматривать детальную информацию о каждом персонаже
- Получать ИИ-сгенерированные описания персонажей
- Переключаться между светлой и тёмной темой
- Наслаждаться анимациями в стиле порталов из мультсериала

## Технический стек

### Frontend
- **Angular 21** — современный фреймворк с сигналами и standalone-компонентами
- **TypeScript** — строгая типизация для надёжности кода
- **SCSS** — CSS-переменные для темизации
- **RxJS** — реактивное управление данными

### Почему выбран этот стек

**Angular 21** был выбран по следующим причинам:

1. **Signals** — новая система реактивности Angular обеспечивает более предсказуемое управление состоянием и лучшую производительность по сравнению с традиционным Change Detection
2. **Standalone Components** — упрощают архитектуру, устраняя необходимость в NgModules
3. **SSR из коробки** — встроенная поддержка Server-Side Rendering улучшает SEO и время первой загрузки
4. **Строгая типизация** — TypeScript интеграция на уровне фреймворка снижает количество runtime-ошибок
5. **Dependency Injection** — мощная система DI упрощает тестирование и поддержку кода
6. **Angular CLI** — автоматизация сборки, тестирования и деплоя

**RxJS** используется для:
- Обработки HTTP-запросов с retry и error handling
- Debounce при поиске для оптимизации запросов
- Управления асинхронными потоками данных

## Инструкции по установке и запуску

### Требования
- Node.js 18+
- npm 9+
- Запущенный backend на `http://127.0.0.1:8000`

### Установка

```bash
# Клонирование репозитория
git clone <repository-url>
cd frondend

# Установка зависимостей
npm install
```

### Запуск в режиме разработки

```bash
npm start
```

Приложение будет доступно по адресу `http://localhost:4200`

### Сборка для production

```bash
npm run build
```

### Запуск SSR-сервера

```bash
npm run serve:ssr:frondend
```

## Архитектура и структура проекта

```
src/
├── app/
│   ├── core/                    # Синглтон-сервисы и модели
│   │   ├── models/
│   │   │   ├── character.model.ts
│   │   │   └── ai.model.ts
│   │   └── services/
│   │       ├── character.service.ts
│   │       ├── ai.service.ts
│   │       └── theme.service.ts
│   ├── shared/                  # Переиспользуемые компоненты
│   │   └── components/
│   │       ├── character-card/
│   │       ├── character-grid/
│   │       ├── search-bar/
│   │       ├── loading-skeleton/
│   │       └── theme-toggle/
│   ├── features/                # Feature-модули (страницы)
│   │   ├── search/
│   │   └── character-detail/
│   ├── app.routes.ts            # Клиентская маршрутизация
│   └── app.routes.server.ts     # SSR-конфигурация
├── styles.scss                  # Глобальные стили и темы
└── server.ts                    # Express SSR-сервер
```

## Процесс проектирования и разработки

### Этап 1: Архитектура
- Определена модульная структура с разделением на core, shared и features
- Выбран подход standalone-компонентов без NgModules
- Спроектирована система тем с CSS-переменными

### Этап 2: Базовая функциональность
- Реализован сервис для работы с Rick and Morty API
- Созданы компоненты для отображения списка и карточек персонажей
- Добавлен поиск с debounce

### Этап 3: Детальная страница
- Реализована страница персонажа с полной информацией
- Добавлена навигация между страницами
- Настроен SSR для динамических маршрутов

### Этап 4: ИИ-интеграция
- Создан сервис для работы с AI API
- Добавлена возможность генерации описаний персонажей
- Реализована обработка ошибок и состояний загрузки

### Этап 5: UX и визуальные эффекты
- Добавлены анимации в стиле порталов
- Реализовано переключение тем
- Оптимизирована отзывчивость интерфейса

## Уникальные подходы и методологии

### 1. Сигналы вместо традиционного Change Detection
```typescript
protected readonly isLoading = signal(true);
protected readonly character = signal<Character | null>(null);

protected readonly statusClass = computed(() => {
  const status = this.character()?.status.toLowerCase();
  return status === 'alive' ? 'alive' : status === 'dead' ? 'dead' : 'unknown';
});
```
Сигналы обеспечивают более явное управление состоянием и автоматическую оптимизацию перерисовки.

### 2. CSS-переменные для темизации
```scss
:root {
  --bg-primary: #0a0a0a;
  --text-primary: #fafafa;
}

[data-theme="light"] {
  --bg-primary: #fafafa;
  --text-primary: #0a0a0a;
}
```
Смена темы происходит мгновенно без перерасчёта стилей в JavaScript.

### 3. Ленивая загрузка маршрутов
```typescript
{
  path: 'character/:id',
  loadComponent: () => import('./features/character-detail/character-detail.component')
    .then(m => m.CharacterDetailComponent),
}
```
Уменьшает начальный размер бандла и ускоряет первую загрузку.

### 4. Graceful degradation для ИИ-функций
ИИ-описания загружаются по запросу пользователя, а не автоматически, что снижает нагрузку на backend и улучшает UX при недоступности AI-сервиса.

## Компромиссы при разработке

### 1. Inline Templates vs External Files
**Решение:** Inline templates для всех компонентов.

**Причина:** Упрощает навигацию по коду — вся логика компонента в одном файле. Для небольших и средних компонентов это ускоряет разработку.

**Компромисс:** Файлы компонентов становятся длиннее, что может затруднить чтение для очень сложных шаблонов.

### 2. SSR Render Mode для динамических маршрутов
**Решение:** `RenderMode.Server` вместо `RenderMode.Prerender` для `/character/:id`.

**Причина:** Prerender требует знать все ID заранее через `getPrerenderParams`, что непрактично для 800+ персонажей.

**Компромисс:** Первый запрос к странице персонажа чуть медленнее, чем для статических страниц.

### 3. Хранение темы в localStorage
**Решение:** Тема сохраняется в localStorage и применяется через `data-theme` атрибут.

**Причина:** Простота реализации, мгновенное применение при загрузке.

**Компромисс:** При SSR возможен "flash" неправильной темы до гидратации. Решается inline-скриптом в index.html.

### 4. Жёстко заданный URL backend
**Решение:** URL `http://127.0.0.1:8000` указан непосредственно в сервисах.

**Причина:** Упрощение конфигурации на этапе разработки.

**Компромисс:** Для production потребуется environment-файлы или конфигурация через build-time переменные.

### 5. Отсутствие кэширования API-запросов
**Решение:** Каждый запрос выполняется заново.

**Причина:** Простота реализации, актуальность данных.

**Компромисс:** Больше сетевых запросов. Для оптимизации можно добавить кэширование через RxJS shareReplay или service worker.

## Известные ошибки и ограничения

### 1. Flash of Wrong Theme (FOWT)
**Описание:** При загрузке страницы может быть кратковременно видна неправильная тема до применения сохранённых настроек.

**Решение:** Добавить inline-скрипт в `<head>` для чтения темы из localStorage до рендеринга.

### 2. Отсутствие обработки offline-режима
**Описание:** Приложение не работает без сети.

**Решение:** Реализовать Service Worker с кэшированием критических ресурсов.

### 3. Нет валидации ID персонажа
**Описание:** При переходе на `/character/abc` будет показана ошибка загрузки вместо redirect на главную.

**Решение:** Добавить guard для валидации параметров маршрута.

### 4. Локализация не полная
**Описание:** Некоторые данные (status, species, gender) приходят с API на английском.

**Решение:** Создать маппинг для перевода значений из API.

### 5. Нет пагинации на мобильных
**Описание:** Кнопки пагинации могут быть неудобны на маленьких экранах.

**Решение:** Реализовать infinite scroll как альтернативу.

### 6. Размер стилей компонентов
**Описание:** Некоторые компоненты превышают рекомендуемый бюджет в 4kB.

**Текущее решение:** Увеличен бюджет до 8kB warning / 16kB error.

**Оптимальное решение:** Вынести общие стили в глобальные файлы.

## API Endpoints

Приложение ожидает следующие endpoints от backend:

| Method | Endpoint | Описание |
|--------|----------|----------|
| GET | `/api/characters` | Список персонажей с фильтрацией |
| GET | `/api/characters/:id` | Информация о персонаже |
| GET | `/api/ai/character-description/:id` | ИИ-описание персонажа |
| POST | `/api/ai/chat` | Чат с ИИ о персонаже |

### Query параметры для `/api/characters`
- `name` — фильтр по имени
- `status` — фильтр по статусу (Alive, Dead, unknown)
- `species` — фильтр по виду
- `gender` — фильтр по полу
- `page` — номер страницы

## Лицензия

MIT
